<import name="tab-bar-custom" src="../../components/TabBar/index.ux"></import>
<template>
  <div class="wrapper">
    <div class="content-main">
      <!-- ä»Šæ—¥çŠ¶æ€ -->
      <div class="section status-card">
        <text class="section-label">ä»Šæ—¥çŠ¶æ€</text>
        <div class="status-inner">
          <image class="status-image" if="{{statusImage}}" src="{{statusImage}}" />
          <div class="status-text-wrap">
            <text class="status-title">{{statusTitle}}</text>
            <text class="status-desc">{{statusDesc}}</text>
          </div>
        </div>
      </div>
      <!-- ä»Šæ—¥å»ºè®® -->
      <div class="section suggest-card">
        <text class="section-label">ä»Šæ—¥å»ºè®®</text>
        <div class="suggest-inner">
          <text class="suggest-dir">{{todaySuggestion}}</text>
          <text class="suggest-hint">{{todayHint}}</text>
        </div>
      </div>
      <!-- å¿«æ·å·¥å…·å…¥å£ -->
      <div class="section tools-section">
        <text class="section-label">å¿«æ·å·¥å…·</text>
        <div class="tool-card" onclick="goToMeditation">
          <text class="tool-icon">ğŸ§˜</text>
          <text class="tool-title">ç»ƒä¹ è®¡æ—¶</text>
          <text class="tool-desc">ä¸“æ³¨å½“ä¸‹ï¼Œé™å¿ƒå†¥æƒ³</text>
        </div>
        <div class="tool-card" onclick="goToPractice">
          <text class="tool-icon">ğŸ§˜â€â™€ï¸</text>
          <text class="tool-title">ç‘œä¼½åŠ¨ä½œ</text>
          <text class="tool-desc">å­¦ä¹ æ ‡å‡†ä½“å¼ä¸æ­¥éª¤</text>
        </div>
        <div class="tool-card" onclick="goToKnowledge">
          <text class="tool-icon">ğŸ“š</text>
          <text class="tool-title">ç‘œä¼½å°çŸ¥è¯†</text>
          <text class="tool-desc">äº†è§£æ›´å¤šç‘œä¼½çŸ¥è¯†</text>
        </div>
      </div>
      <!-- åº•éƒ¨è¯´æ˜ -->
      <div class="footer-note">
        <text class="footer-note-text">è½»ç‘œä¼½ Â· ä¸“æ³¨å·¥å…·ï¼ŒåŠ©ä½ æ¯æ—¥ä¸€ç‚¹ç»ƒä¹ </text>
      </div>
    </div>
    <!-- åº•éƒ¨ TabBar -->
    <tab-bar-custom current="{{0}}"></tab-bar-custom>
    <!-- éšç§æ”¿ç­–å¼¹çª— -->
    <div class="privacy-popup-bg" if="{{isShowPrivacyPopup}}">
      <div class="privacy-popup-box">
        <text class="privacy-popup-title">æ¸©é¦¨æç¤º</text>
        <text class="privacy-popup-content">
          <span>æ¬¢è¿ä½¿ç”¨æœ¬åº”ç”¨ï¼æœ¬åº”ç”¨éå¸¸é‡è§†æ‚¨çš„éšç§å’Œä¸ªäººä¿¡æ¯ä¿æŠ¤ã€‚åœ¨æ‚¨ä½¿ç”¨æœ¬åº”ç”¨å‰ï¼Œè¯·è®¤çœŸé˜…è¯»</span>
          <text class="privacy-link" onclick="goToPrivacyPolicy('agreement')">ã€Šç”¨æˆ·åè®®ã€‹</text>
          <span>åŠ</span>
          <text class="privacy-link" onclick="goToPrivacyPolicy('privacy')">ã€Šéšç§æ”¿ç­–ã€‹</text>
          <span>æ‚¨åŒæ„å¹¶æ¥å—å…¨éƒ¨æ¡æ¬¾åæ–¹å¯å¼€å§‹ä½¿ç”¨æœ¬åº”ç”¨ã€‚</span>
        </text>
        <div class="privacy-popup-btn-box">
          <text class="privacy-popup-btn-disagree" onclick="disagree">ä¸åŒæ„</text>
          <text class="privacy-popup-btn-agree" onclick="agree">åŒæ„å¹¶ç»§ç»­</text>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import router from '@system.router'
import storage from '@system.storage'

const SUGGESTIONS = [
  { dir: 'å‘¼å¸ä¸æ”¾æ¾', hint: 'é€‚åˆåš 5ï½10 åˆ†é’Ÿå‘¼å¸ç»ƒä¹ æˆ–çŸ­æ—¶å†¥æƒ³ã€‚' },
  { dir: 'æŸ”éŸ§ä¸æ‹‰ä¼¸', hint: 'å¯å¤šåšè‚©é¢ˆã€èƒŒéƒ¨æ‹‰ä¼¸ï¼Œç¼“è§£ä¹…åç–²åŠ³ã€‚' },
  { dir: 'å¹³è¡¡ä¸ç¨³å®š', hint: 'é€‚åˆç»ƒä¹ æ ‘å¼ã€æˆ˜å£«ä¸€ç­‰ç«™ç«‹ä½“å¼ã€‚' },
  { dir: 'åŠ›é‡ä¸æ ¸å¿ƒ', hint: 'å¯åŠ å…¥å¹³æ¿ã€èˆ¹å¼ç­‰æ ¸å¿ƒä½“å¼ã€‚' },
  { dir: 'ç»¼åˆç»ƒä¹ ', hint: 'å®‰æ’ 15ï½20 åˆ†é’Ÿä¸²è”ï¼Œå…¼é¡¾å‘¼å¸ä¸ä½“å¼ã€‚' },
  { dir: 'ä¼‘æ¯ä¸ä¿®å¤', hint: 'ä»¥å©´å„¿å¼ã€ä»°å§æ”¾æ¾ä¸ºä¸»ï¼Œå°‘åšå¼ºåº¦ç»ƒä¹ ã€‚' },
  { dir: 'ç»¼åˆç»ƒä¹ ', hint: 'å‘¨æœ«å¯é€‚å½“å»¶é•¿ç»ƒä¹ æ—¶é—´ï¼Œå·©å›ºæœ¬å‘¨å†…å®¹ã€‚' }
]

export default {
  private: {
    isShowPrivacyPopup: false,
    statusTitle: 'æ–°çš„ä¸€å¤©',
    statusDesc: 'ä»ä¸€æ®µç®€çŸ­ç»ƒä¹ å¼€å§‹å§',
    statusImage: '',
    todaySuggestion: '',
    todayHint: ''
  },
  onInit() {
    this.$page.setTitleBar({ text: 'è½»ç‘œä¼½' })
    this.setTodayStatus()
    this.setTodaySuggestion()
  },
  onShow() {
    const that = this
    storage.get({
      key: 'isAgreePrivacyPolicy',
      success: function(data) {
        if (data === 'true') {
          that.isShowPrivacyPopup = false
        } else {
          setTimeout(() => {
            that.isShowPrivacyPopup = true
          }, 500)
        }
      },
      fail: function() {
        setTimeout(() => {
          that.isShowPrivacyPopup = true
        }, 500)
      }
    })
  },
  setTodayStatus() {
    const hour = new Date().getHours()
    if (hour < 12) {
      this.statusTitle = 'æ—©å®‰'
      this.statusDesc = 'æ™¨é—´é€‚åˆå‘¼å¸ä¸è½»åº¦æ‹‰ä¼¸'
      this.statusImage = '/assets/images/Chakras-cuate.png'
    } else if (hour < 18) {
      this.statusTitle = 'åˆå'
      this.statusDesc = 'å¯åšçŸ­æ—¶æ”¾æ¾æˆ–è‚©é¢ˆæ‹‰ä¼¸'
      this.statusImage = '/assets/images/Yoga-practice-bro.png'
    } else {
      this.statusTitle = 'æ™šé—´'
      this.statusDesc = 'é€‚åˆèˆ’ç¼“ç»ƒä¹ æˆ–å†¥æƒ³'
      this.statusImage = '/assets/images/Mindfulness-amico.png'
    }
  },
  setTodaySuggestion() {
    const index = Math.floor(Math.random() * SUGGESTIONS.length)
    const item = SUGGESTIONS[index]
    this.todaySuggestion = item.dir
    this.todayHint = item.hint
  },
  goToMeditation() {
    router.push({ uri: '/pages/Meditation' })
  },
  goToPractice() {
    router.push({ uri: 'pages/PracticeList' })
  },
  goToKnowledge() {
    router.push({ uri: 'pages/KnowledgeList' })
  },
  goToPrivacyPolicy(type) {
    router.push({
      uri: 'pages/PrivacyPolicy',
      params: { tab: type === 'agreement' ? 'agreement' : 'privacy' }
    })
  },
  disagree() {
    this.$app.exit()
  },
  agree() {
    const that = this
    storage.set({
      key: 'isAgreePrivacyPolicy',
      value: 'true',
      success: function() {},
      fail: function() {}
    })
    this.isShowPrivacyPopup = false
  }
}
</script>

<style lang="less">
@import './../../assets/styles/style.less';

.wrapper {
  flex-direction: column;
  align-items: stretch;
  flex: 1;
  width: 100%;
  background-color: @bg-main;
  position: relative;
}

.content-main {
  flex: 1;
  flex-direction: column;
  align-items: stretch;
  width: 100%;
  padding: 24 * @size-factor 20 * @size-factor 16 * @size-factor;
  padding-bottom: 120px;
}

.section {
  flex-direction: column;
  align-items: stretch;
  width: 100%;
  margin-bottom: 24 * @size-factor;
}

.section-label {
  font-size: 24px;
  color: @grey;
  margin-bottom: 12 * @size-factor;
  padding-left: 4 * @size-factor;
}

/* ä»Šæ—¥çŠ¶æ€å¡ç‰‡ - ä¸€å±å¤§å¡ç‰‡ + å›¾ç‰‡ */
.status-card .status-inner {
  flex-direction: column;
  align-items: stretch;
  width: 100%;
  min-height: 520 * @size-factor;
  background-color: @white;
  border-radius: 24 * @size-factor;
  padding: 0;
  border-left-width: 6 * @size-factor;
  border-left-color: @brand;
  overflow: hidden;
}

.status-image {
  width: 100%;
  height: 520 * @size-factor;
  object-fit: contain;
  object-position: center;
  background-color: #FDF5EF;
}

.status-text-wrap {
  flex-direction: column;
  align-items: flex-start;
  width: 100%;
  padding: 28 * @size-factor 28 * @size-factor 32 * @size-factor;
}

.status-title {
  font-size: 42px;
  font-weight: bold;
  color: @black;
  margin-bottom: 12 * @size-factor;
  width: 100%;
}

.status-desc {
  font-size: 28px;
  color: @grey;
  width: 100%;
}

/* ä»Šæ—¥å»ºè®® */
.suggest-card .suggest-inner {
  flex-direction: column;
  align-items: flex-start;
  width: 100%;
  background-color: #FDF5EF;
  border-radius: 16 * @size-factor;
  padding: 24 * @size-factor;
  border: 1px solid @border-color;
}

.suggest-dir {
  font-size: 30px;
  font-weight: bold;
  color: @brand;
  margin-bottom: 8 * @size-factor;
  width: 100%;
}

.suggest-hint {
  font-size: 26px;
  color: @grey;
  width: 100%;
}

/* å¿«æ·å·¥å…· */
.tools-section {
  flex-direction: column;
  align-items: stretch;
}

.tool-card {
  flex-direction: column;
  align-items: flex-start;
  width: 100%;
  flex-shrink: 0;
  background-color: @white;
  border-radius: 16 * @size-factor;
  padding: 24 * @size-factor 28 * @size-factor;
  margin-bottom: 16 * @size-factor;
  border: 1px solid @border-color;
}

.tool-icon {
  font-size: 44px;
  margin-bottom: 12 * @size-factor;
}

.tool-title {
  font-size: 32px;
  font-weight: bold;
  color: @black;
  margin-bottom: 6 * @size-factor;
  width: 100%;
}

.tool-desc {
  font-size: 26px;
  color: @grey;
  width: 100%;
}

/* åº•éƒ¨è¯´æ˜ */
.footer-note {
  flex-direction: column;
  align-items: center;
  width: 100%;
  padding: 20 * @size-factor 0 24 * @size-factor;
}

.footer-note-text {
  font-size: 24px;
  color: @grey;
  margin-bottom: 16 * @size-factor;
  width: 100%;
  text-align: center;
}

.footer-legal {
  flex-direction: row;
  justify-content: center;
  align-items: center;
}

.footer-legal-link {
  font-size: 24px;
  color: @brand;
  text-decoration: underline;
}

.footer-legal-divider {
  font-size: 24px;
  color: @grey;
  margin: 0 12 * @size-factor;
}

/* éšç§å¼¹çª— */
.privacy-popup-bg {
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

.privacy-popup-box {
  width: 600px;
  min-height: 400px;
  flex-direction: column;
  align-items: center;
  background-color: @white;
  border-radius: 20 * @size-factor;
  padding: 40 * @size-factor;
}

.privacy-popup-title {
  font-size: 36px;
  color: @black;
  font-weight: bold;
  margin-bottom: 30 * @size-factor;
  text-align: center;
}

.privacy-popup-content {
  font-size: 28px;
  color: @grey;
  width: 100%;
  margin-bottom: 40 * @size-factor;
}

.privacy-link {
  color: @brand;
  text-decoration: underline;
}

.privacy-popup-btn-box {
  width: 100%;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  margin-top: 20 * @size-factor;
}

.privacy-popup-btn-disagree {
  width: 220px;
  height: 80px;
  border: 2px solid #979797;
  color: #999999;
  text-align: center;
  border-radius: 12 * @size-factor;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 28px;
}

.privacy-popup-btn-agree {
  width: 220px;
  height: 80px;
  color: @white;
  background-color: @brand;
  text-align: center;
  border-radius: 12 * @size-factor;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 28px;
}
</style>
