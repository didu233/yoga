<template>
  <div class="wrapper">
    <div class="header">
      <text class="app-title">è½»ç‘œä¼½</text>
      <text class="app-subtitle">è®©èº«å¿ƒå›å½’å¹³é™</text>
    </div>
    <div class="content">
      <div class="card" onclick="goToMeditation">
        <div class="card-icon meditation-icon">ğŸ§˜</div>
        <text class="card-title">è®¡æ—¶å†¥æƒ³</text>
        <text class="card-desc">ä¸“æ³¨å½“ä¸‹ï¼Œé™å¿ƒå†¥æƒ³</text>
      </div>
      <div class="card" onclick="goToPractice">
        <div class="card-icon practice-icon">ğŸ§˜â€â™€ï¸</div>
        <text class="card-title">ç»ƒä¹ åŠ¨ä½œ</text>
        <text class="card-desc">å­¦ä¹ æ ‡å‡†ç‘œä¼½ä½“å¼</text>
      </div>
      <div class="card" onclick="goToKnowledge">
        <div class="card-icon knowledge-icon">ğŸ“š</div>
        <text class="card-title">ç‘œä¼½å°çŸ¥è¯†</text>
        <text class="card-desc">äº†è§£æ›´å¤šç‘œä¼½çŸ¥è¯†</text>
      </div>
    </div>
    <!-- éšç§æ”¿ç­–å¼¹çª— -->
    <div class="privacy-popup-bg" if="{{isShowPrivacyPopup}}">
      <div class="privacy-popup-box">
        <text class="privacy-popup-title">æ¸©é¦¨æç¤º</text>
        <text class="privacy-popup-content">
          <span>æ¬¢è¿ä½¿ç”¨æœ¬åº”ç”¨ï¼æœ¬åº”ç”¨éå¸¸é‡è§†æ‚¨çš„éšç§å’Œä¸ªäººä¿¡æ¯ä¿æŠ¤ã€‚åœ¨æ‚¨ä½¿ç”¨æœ¬åº”ç”¨å‰ï¼Œè¯·è®¤çœŸé˜…è¯»</span>
          <text class="privacy-link" onclick="goToPrivacyPolicy('agreement')">ã€Šç”¨æˆ·åè®®ã€‹</text>
          <span>åŠ</span>
          <text class="privacy-link" onclick="goToPrivacyPolicy('privacy')">ã€Šéšç§æ”¿ç­–ã€‹</text>
          <span>æ‚¨åŒæ„å¹¶æ¥å—å…¨éƒ¨æ¡æ¬¾åæ–¹å¯å¼€å§‹ä½¿ç”¨æœ¬åº”ç”¨ã€‚</span>
        </text>
        <div class="privacy-popup-btn-box">
          <text class="privacy-popup-btn-disagree" onclick="disagree">ä¸åŒæ„</text>
          <text class="privacy-popup-btn-agree" onclick="agree">åŒæ„å¹¶ç»§ç»­</text>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import router from '@system.router'
import storage from '@system.storage'

export default {
  private: {
    isShowPrivacyPopup: false
  },
  onInit() {
    this.$page.setTitleBar({ text: 'è½»ç‘œä¼½' })
  },
  onShow() {
    // æ£€æŸ¥æ˜¯å¦å·²åŒæ„éšç§æ”¿ç­–
    const that = this
    storage.get({
      key: 'isAgreePrivacyPolicy',
      success: function(data) {
        if (data === 'true') {
          that.isShowPrivacyPopup = false
        } else {
          setTimeout(() => {
            that.isShowPrivacyPopup = true
          }, 500)
        }
      },
      fail: function(data, code) {
        // å¦‚æœè·å–å¤±è´¥ï¼Œæ˜¾ç¤ºå¼¹çª—
        setTimeout(() => {
          that.isShowPrivacyPopup = true
        }, 500)
      }
    })
  },
  goToMeditation() {
    router.push({
      uri: '/pages/Meditation'
    })
  },
  goToPractice() {
    router.push({
      uri: 'pages/PracticeList'
    })
  },
  goToKnowledge() {
    router.push({
      uri: 'pages/KnowledgeList'
    })
  },
  goToPrivacyPolicy(type) {
    router.push({
      uri: 'pages/PrivacyPolicy',
      params: {
        tab: type === 'agreement' ? 'agreement' : 'privacy'
      }
    })
  },
  disagree() {
    this.$app.exit()
  },
  agree() {
    const that = this
    storage.set({
      key: 'isAgreePrivacyPolicy',
      value: 'true',
      success: function(data) {
        console.log('éšç§æ”¿ç­–åŒæ„çŠ¶æ€å·²ä¿å­˜')
      },
      fail: function(data, code) {
        console.log('ä¿å­˜å¤±è´¥ï¼Œcode = ' + code)
      }
    })
    this.isShowPrivacyPopup = false
  }
}
</script>

<style lang="less">
@import './../../assets/styles/style.less';

.wrapper {
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  flex: 1;
  background-color: @bg-main;
  position: relative;
}

.header {
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100%;
  padding: 40 * @size-factor 20 * @size-factor 30 * @size-factor;
}

.app-title {
  font-size: 48px;
  font-weight: bold;
  color: @black;
  margin-bottom: 10 * @size-factor;
}

.app-subtitle {
  font-size: 28px;
  color: @grey;
}

.content {
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  width: 100%;
  padding: 0 20 * @size-factor 20 * @size-factor;
}

.card {
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100%;
  background-color: @white;
  border-radius: 16 * @size-factor;
  padding: 30 * @size-factor;
  margin-bottom: 24 * @size-factor;
  border: 1px solid @border-color;
  flex-shrink: 0;
}

.card-icon {
  font-size: 60px;
  margin-bottom: 16 * @size-factor;
}

.card-title {
  font-size: 36px;
  font-weight: bold;
  color: @black;
  margin-bottom: 8 * @size-factor;
}

.card-desc {
  font-size: 26px;
  color: @grey;
  text-align: center;
}

/* éšç§æ”¿ç­–å¼¹çª—æ ·å¼ */
.privacy-popup-bg {
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

.privacy-popup-box {
  width: 600px;
  min-height: 400px;
  flex-direction: column;
  align-items: center;
  background-color: @white;
  border-radius: 20 * @size-factor;
  padding: 40 * @size-factor;
}

.privacy-popup-title {
  font-size: 36px;
  color: @black;
  font-weight: bold;
  margin-bottom: 30 * @size-factor;
  text-align: center;
}

.privacy-popup-content {
  font-size: 28px;
  color: @grey;
  line-height: 1.6;
  width: 100%;
  margin-bottom: 40 * @size-factor;
}

.privacy-link {
  color: @brand;
  text-decoration: underline;
}

.privacy-popup-btn-box {
  width: 100%;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  margin-top: 20 * @size-factor;
}

.privacy-popup-btn-disagree {
  width: 220px;
  height: 80px;
  border: 2px solid #979797;
  color: #999999;
  text-align: center;
  border-radius: 12 * @size-factor;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 28px;
}

.privacy-popup-btn-agree {
  width: 220px;
  height: 80px;
  color: @white;
  background-color: @brand;
  text-align: center;
  border-radius: 12 * @size-factor;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 28px;
}
</style>
